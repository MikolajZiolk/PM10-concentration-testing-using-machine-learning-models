---
title: "Prezentacja_CalPM"
author: "Team2"
abstract-title: "Temat"
abstract: "Zaprezentowanie przebiegu pracy i wynik贸w projektu CalPM"
format: 
  html:
    toc: true
    toc-depth: 3
    toc-location: right
    toc-title: Spis Treci
    number-sections: true
    number-depth: 3
    embed-resources: true
    html-math-method: katex
    code-tools: true
    code-block-bg: true
    code-fold: show
    code-summary: "Show and hide code"
    link-external-icon: true
    link-external-newwindow: true
    smooth-scroll: true
    self-contained: true
    citation: true
    theme: 
        dark: solar
        light: flatly
    fontsize: 1.0em
    linestretch: 1.3
    fig-align: center
execute: 
  echo: true
  error: false
  warning: false
  output: true
---

```{r}
#| echo: false
#| results: "hide"
#| label: Pakiety
pkg <- c(
  "ggthemes",
  "ggplot2"
)

pkg |>
  purrr::map(
    .f = ~ require(.x, character.only = T) |> paste(.x)
  )
rm(pkg)
#setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
load("./plot_data.RData")
```

## Organizacja pracy

Praca bya wykonywana w przybli偶eniu przebiegaa nastepujcego wedug diagramu blokowego:

![Diagram blokowy przedstawiajcy workflow](images/mindmap_calpm.png)

Praca rozpoczynaa si zawsze od spotkania, om贸wienia wsp贸lnie obecnego stanu projektu/celu, wyznaczeniu zada na nastpny tydzie i zapisaniu ich w Plannerze (appka teams):![Wygld tablicy pod koniec projektu](images/clipboard-1910004781.png){width="1300"}

Starano si aby ka偶dy na tydzie mia wyznaczone zadanie, kt贸re bdzie mogo by wykonywane r贸wnolegle z reszt zespou, nie zawsze byo to jednak atwe do osignicia.

Np. przy starcie projektu nala偶ao stworzy pierwszy plik, w kt贸rym zostan wczytane podstawowe biblioteki oraz dane. Gdyby ka偶dy to zrobi z osobna, zostay by zmarnowane zasoby na powtarzanie tej samej czynnoci i ci偶ko byo by dokona tego merge. Dlatego niekt贸re czynnoci, kt贸re musiay by wykonane tylko raz i wstrzymywayby reszte zespou przed prac byy przypisowane do os贸b, kt贸re wyra偶ay mo偶liwo szybkiego wykonania taska.

**Praca w jednym pliku** - celem wiczenia, aby lepiej widzie postpujcy kod pisany przez innych i stworzenie merge conflict贸w zdecydowano si na prac w jednym pliku R. Wraz z rozwojem projektu, plik osigna 1000+ linijek, co robi si ci偶kie do nawigowania po nim.

**Praca z gitem -** po wyznaczeniu task贸w, ka偶dy m贸g stworzy od main'a sw贸j branch, na kt贸rym m贸g bez przeszk贸d wykonywa zadanie, po uznaniu go za speniajce kryteria, wystawia pull request, lider robi review, gdzie decydowa si na przyczenie (bd藕 tez nie, wtedy zostawia feedback ) do maina. Merge conflicty r贸wnie偶 byy rozwizywane przez lidera. Po udanym merge lider odchacza taska w plannerze.

![](images/clipboard-1210523945.png)

# Wykonywanie projektu

Sam projekt CalPM, zosta podzielony na czci - przygotwanie skryptu, przygotowanie przepis贸w, przygotwanie i trenowanie modeli, sprawdzenie modeli na walidacyjnym zestawie danych i sporzdzenie metryk i wykres贸w.

Kroki wykonywane przy wykonywaniu projektu, wszystko co mogo by robione r贸wnolegle jest napisane w jednym kroku.

1.  Stworzenie skryptu z podstawowymi danymi

2.  Utworzenie przykadowego przepisu (umo偶liwia ka偶demu tworzenie model贸w)

3.  Wytrenowanie wybranych modeli, utworzenie dodatkowych przepis贸w (najbardziej pracochonny krok)

4.  Sprawdzenie wszystkich modeli na zestawie walidacyjnym, utworzenie wykres贸w metryk i tabeli por贸wnawczych modeli.

W skrypcie za pomoc komentarzy wydzielano wsp贸lne i osobne przestrzenie, dla przykadu:

```{r}
#| eval: false
# loading all libraries and files
# List of required packages !!!! please add your libraries to the vector !!!!
required_packages <- c("tidyverse", "data.table", "dplyr",
                       "ggpubr", "ranger", "modeldata", "tidymodels",
                       "rpart.plot", "readr","vip", "ggthemes", 
                       "parsnip", "GGally", "skimr", "xgboost",
                       "doParallel", "kernlab", "ggplot2")  
#

[...]

## XGBoost model ---------------------------------------------------------------

# XGBoost model specification
xgboost_model <- 
  boost_tree(
    mode = "regression",
    trees = 200,
    min_n = tune(),
    tree_depth = tune(),
    learn_rate = tune(),
    loss_reduction = tune()
  ) |> 
  [...]
```

Wszystkie wytrenowane modele (na tym samym seedzie) byy zapisywane do pliku, celem uniknicia ponownego wykonywania czasochonnych operacji. Zastosowano proste wyra偶enie IF/ELSE kt贸rym mo偶na decydowac czy chcemy wykonac cay skrypt trenujc modele od nowa

```{r}
#| eval: false
# It is better to load stored data, computation takes too long
if (xgboost_load_data) {
  
  load("xgboost_data.RData")
  
} else {

# Parallel computing 
  cores = detectCores()
  cl = makeCluster(cores)
  registerDoParallel(cl)

# Hyperparameter tuning
  xgboost_tuned_basic <- 
    tune_grid(
    object = xgboost_wf_basic,
    resamples = xgboost_folds,
    grid = xgboost_grid,
    metrics = xgboost_metrics,
    control = control_grid(verbose = TRUE)
)
```

# Lessons Learned

-   Warto lepiej zgbi temat przed planowaniem pracy - jako lider na pocztku nie za bardzo rozumiaem scope caego projektu, gdyby to poprawi mo偶na by lepiej zaplanowa r贸wnoleg prac w projekcie oraz powici wicej czasu na dopracowanie modeli/zwikszenie liczebnoci.

-   Mo偶liwe ustalenie wszystkich potrzebnych wsp贸lnych konwencji - jaki seed, w jakiej formie ka偶dy powinien przedstawi wydajnoc swojego modelu, jak nazywa zmienne, aby unikn chaosu (team poradzi sobie z tym tematem bardzo dobrze, ale myl 偶e jako lider powinienem to poruszy).

-   Przekombinowanie plannera - w tak prostym projekcie nie potrzebne jest, aby ka偶dy oznajmia nad czym obecnie pracuje, a co ma ju偶 oddane, jest to projekt wykonywany w wolnym czasie. Metodologi pracy nale偶y dobiera do potrzeb zespou.

# Wyniki projektu

cdn.
